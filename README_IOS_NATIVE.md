# Telegram iOS 原生 App 去广告指南

## 🎯 目标

屏蔽 iOS Telegram 原生应用中频道顶部显示的赞助广告（蓝色"广告"标签）。

## ⚠️ 重要说明

### 技术挑战

Telegram 使用 **MTProto 协议**，这是一个加密的专有协议。大部分广告数据通过 MTProto 传输，**理论上无法被 MITM 拦截**。

但是，我们仍然可以尝试：

1. **拦截可能的 HTTPS 请求**
   - Telegram 的某些资源（图片、配置）可能通过 HTTPS CDN 加载
   - 广告图片可能有独立的 URL

2. **多层过滤策略**
   - 在多个层面尝试识别和过滤广告
   - 即使效果有限，也值得一试

3. **实验性方案**
   - 本插件采用实验性技术
   - 效果需要实际测试验证

## 🚀 快速开始

### 第一步：安装 Loon 并配置 MITM

1. **安装 Loon**
   - 从 App Store 下载 Loon (需购买)
   - 或使用 TestFlight 版本

2. **生成并安装 MITM 证书**
   ```
   Loon → 配置 → MITM → 证书管理 → 生成新的 CA 证书
   ```

3. **安装描述文件**
   ```
   点击"安装证书" → 前往"设置" → 已下载描述文件 → 安装
   ```

4. **信任证书**
   ```
   设置 → 通用 → 关于本机 → 证书信任设置 → 启用 Loon 证书
   ```

### 第二步：导入插件

1. **复制插件 URL**
   ```
   https://raw.githubusercontent.com/g1z2f/loon-telegram-adblocker-/main/TelegramAdBlock.plugin
   ```

2. **在 Loon 中添加**
   ```
   Loon → 配置 → 插件 → 右上角 "+" → 粘贴 URL → 确定
   ```

3. **启用插件**
   ```
   找到"Telegram 去广告" → 打开开关
   ```

### 第三步：测试效果

1. **启用 Loon VPN**
   - 确保 Loon 的 VPN 已连接
   - 状态栏应显示 VPN 图标

2. **访问测试频道**
   - 打开 Telegram
   - 访问大型公开频道（订阅数 > 10万）
   - 例如：新闻频道、科技频道等

3. **查看效果**
   - 检查频道顶部是否还有蓝色"广告"标签
   - 查看 Loon 日志确认是否拦截到请求

## 📊 查看日志

### 如何查看 Loon 日志

1. **打开日志**
   ```
   Loon → 工具 → 日志
   ```

2. **查找关键信息**
   ```
   搜索 "Telegram AdBlocker"
   ```

3. **日志示例**
   ```
   [Telegram AdBlocker v4.0.0-experimental] [SUCCESS] ✓ 移除了 1 个广告项
   [Telegram AdBlocker v4.0.0-experimental] [INFO] 📊 数据大小: 15234 → 12456 bytes
   ```

### 日志级别说明

- `🚀 脚本启动` - 脚本开始执行
- `✓ 识别为 Telegram API 响应` - 成功识别 Telegram 流量
- `🎉 处理完成! 总共移除 X 个广告项` - 成功移除广告
- `⚠️ 检测到二进制数据（可能是 MTProto 协议）` - MTProto 流量无法处理
- `未检测到广告内容` - 当前响应中没有广告

## 🔧 高级配置

### 启用实验性功能

插件中有一些默认禁用的实验性功能，如果基础配置效果不佳，可以尝试启用：

1. **编辑插件文件**
   - 下载插件文件到本地
   - 使用文本编辑器打开 `TelegramAdBlock.plugin`

2. **启用 API 拦截**
   ```
   找到这一行：
   ..., tag=Telegram-API实验, enable=false
   
   改为：
   ..., tag=Telegram-API实验, enable=true
   ```

3. **启用 CDN 过滤**
   ```
   找到这一行：
   ..., tag=Telegram-CDN过滤, enable=false
   
   改为：
   ..., tag=Telegram-CDN过滤, enable=true
   ```

4. **添加更多 MITM 域名**
   ```
   找到 [MITM] 段落，取消注释：
   # hostname = web.telegram.org, *.cdn.telegram.org
   
   改为：
   hostname = web.telegram.org, *.cdn.telegram.org
   ```

### 注意事项

- 启用更多功能可能增加 Loon 的处理负担
- 某些配置可能导致 Telegram 加载速度变慢
- 如出现问题，请关闭实验性功能

## ❓ 常见问题

### Q1: 为什么还是看到广告？

**可能的原因：**

1. **MTProto 协议限制**
   - 大部分广告通过 MTProto 传输
   - MITM 无法解密这些流量
   - 这是技术上的根本限制

2. **MITM 证书未正确配置**
   - 检查证书是否已安装
   - 确认证书已信任
   - 重启 Telegram 和 Loon

3. **插件未启用**
   - 确认插件开关已打开
   - 确认 Loon VPN 已连接

4. **广告类型不同**
   - Telegram 可能更新了广告方式
   - 新的广告格式需要更新插件

### Q2: 如何判断插件是否在工作？

**检查方法：**

1. **查看 Loon 日志**
   - 应该能看到 "Telegram AdBlocker" 的日志
   - 如果完全没有日志，说明没有拦截到流量

2. **测试多个频道**
   - 访问不同的大型频道
   - 有些频道可能没有广告

3. **对比测试**
   - 关闭插件，重启 Telegram
   - 查看是否出现更多广告
   - 开启插件，再次测试

### Q3: 会影响 Telegram 正常使用吗？

**一般不会，但注意：**

- 插件主要拦截广告相关请求
- 不影响正常消息的收发
- 如果出现问题（加载慢、崩溃等），请：
  1. 关闭插件
  2. 重启 Telegram
  3. 反馈问题

### Q4: 效果如何？能完全去除广告吗？

**诚实回答：**

- ❌ 无法保证 100% 去除所有广告
- ⚠️ 由于 MTProto 加密，效果可能有限
- ✅ 某些情况下可能有效（需要测试）
- ✅ 对 Web 版本更有效

**最可靠的方案：**
- 订阅 **Telegram Premium** ($4.99/月)
- 官方支持，完全移除广告
- 额外获得高级功能

### Q5: 为什么不能破解 MTProto？

**技术原因：**

1. **加密强度**
   - MTProto 使用 AES-256 加密
   - 端到端加密设计
   - 破解加密是违法的

2. **尊重隐私**
   - 加密是为了保护用户隐私
   - 破解会损害所有人的安全
   - 我们不应该也不会尝试

3. **技术现实**
   - 即使想破解也做不到
   - 需要 Telegram 的私钥
   - 这是不可能获得的

## 💡 替代方案

如果本插件效果不佳，以下是其他选择：

### 方案 1: Telegram Premium（推荐）✅

**优点：**
- ✅ 官方支持，100% 有效
- ✅ 完全移除所有广告
- ✅ 获得额外高级功能：
  - 4GB 文件上传
  - 更快的下载速度
  - 独特贴纸和表情
  - 更多频道和群组
  - 语音转文字

**价格：**
- $4.99/月 或 $49.99/年

**订阅方法：**
```
Telegram → 设置 → Telegram Premium
```

### 方案 2: 第三方客户端

**iOS 平台：**

1. **Nicegram**
   - App Store 可下载
   - 增强功能
   - 可能有广告过滤

2. **Telegram X**
   - Telegram 官方实验版
   - 更现代的界面
   - 广告显示可能不同

**注意：**
- 第三方客户端可能不稳定
- 功能可能不完整
- 需要自行评估安全性

### 方案 3: 接受广告

**理性的选择：**
- Telegram 需要资金运营
- 广告维持免费服务
- 广告通常不会太打扰
- 这是对 Telegram 的支持

## 🧪 实验性功能说明

### 当前尝试的技术

1. **域名拦截**
   - 拦截第三方广告域名
   - 拦截可能的广告服务器

2. **URL 模式匹配**
   - 识别广告相关的 URL 路径
   - 拦截包含 "sponsor"、"ad" 等关键字的请求

3. **JSON 响应过滤**
   - 解析 API 响应
   - 移除广告相关字段
   - 返回清理后的数据

4. **CDN 资源过滤**
   - 拦截可能的广告图片
   - 过滤广告视频

### 为什么是"实验性"？

1. **不确定性**
   - Telegram API 结构可能变化
   - 广告加载方式可能更新
   - 效果因版本而异

2. **有限的测试**
   - 需要大量用户测试
   - 不同地区可能有不同结果
   - iOS 版本可能影响效果

3. **持续改进**
   - 根据反馈优化
   - 添加新的识别规则
   - 适应 Telegram 的变化

## 📝 反馈和报告

### 如何报告问题

如果您测试后有任何发现，请反馈：

**有效果（广告减少/消失）：**
- ✅ Telegram 版本号
- ✅ iOS 版本
- ✅ 日志截图
- ✅ 哪些广告被移除了
- ✅ 访问的频道类型

**无效果（仍然看到广告）：**
- ❌ Telegram 版本号
- ❌ iOS 版本
- ❌ 日志内容（是否有拦截记录）
- ❌ 广告的截图
- ❌ 是否尝试了高级配置

### 反馈渠道

- **GitHub Issues**: [提交 Issue](https://github.com/g1z2f/loon-telegram-adblocker-/issues)
- **GitHub Discussions**: [参与讨论](https://github.com/g1z2f/loon-telegram-adblocker-/discussions)

## 📖 技术文档

想了解更多技术细节？

- **[TECHNICAL_RESEARCH.md](TECHNICAL_RESEARCH.md)** - 完整的技术研究报告
- **[README.md](README.md)** - 项目主文档
- **[CHANGELOG.md](CHANGELOG.md)** - 更新日志

## 🙏 致谢

- Telegram 团队提供优质的通讯服务
- Loon 开发团队提供强大的工具
- 所有测试用户的反馈和支持

## ⚖️ 免责声明

1. 本插件仅供学习和研究使用
2. 效果因技术限制可能非常有限
3. 建议使用官方的 Telegram Premium
4. 使用本插件的一切后果由用户自行承担
5. 请遵守相关法律法规

---

**最后提醒：**

如果本插件效果不佳，**强烈建议订阅 Telegram Premium**。

这是唯一官方、可靠、100% 有效的去广告方法，还能支持 Telegram 的持续发展。

💙 让我们一起支持优质的通讯服务！
